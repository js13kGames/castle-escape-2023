<div id=viewport>
  <div id=camera>
    <div id=scene></div>
  </div>
</div>

<style>
#viewport{width:960px;height:540px;overflow:hidden;position:relative;perspective:500px}
#viewport *{transform-style:preserve-3d;box-sizing:border-box}
#camera{width:0;height:0;position:absolute;top:50%;left:50%}
/*@font-face { font-family: e; src: url(//xem.github.io/unicode13/Twemoji.ttf) }*/
@font-face { font-family: e; src: url(Twemoji.ttf) }
</style>

<script>
C = {
unit: "px",
camX: 0,
camY: 0,
camZ: 0,
camRX: 0,
camRY: 0,
camRZ: 0,
sprite_count: 0,
sprites: [],
plane_count: 0,
cube_count: 0,
pyramid_count: 0,
options: {},
$: t => self[t],

// Initialize an object's properties
init: t => {
  t.css||(t.css=""),
  t.html||(t.html=""),
  t.g||(t.g="scene"),
  t.o||(t.o="center"),
  /*t.o=="top left"&&(t.x+=t.w/2,t.y+=t.h/2),
  t.o=="top"&&(t.y+=t.h/2),
  t.o=="top right"&&(t.x-=t.w/2,t.y+=t.h/2),
  t.o=="right"&&(t.x-=t.w/2),
  t.o=="bottom right"&&(t.x-=t.w/2,t.y-=t.h/2),
  t.o=="bottom"&&(t.y-=t.h/2),
  t.o=="bottom left"&&(t.x+=t.w/2,t.y-=t.h/2),
  t.o=="left"&&(t.x+=t.w/2),*/
  t.w||(t.w=0),
  t.h||(t.h=0),
  t.x||(t.x=0),
  t.y||(t.y=0),
  t.z||(t.z=0),
  t.rx||(t.rx=0),
  t.ry||(t.ry=0),
  t.rz||(t.rz=0),
  t.sx||(t.sx=1),
  t.sy||(t.sy=1),
  t.sz||(t.sz=1),
  C.options[t.n]=t
},

// Group of objects
/*group: t => { 
  t.d||t.d===0||(t.d=t.h),
  C.init(t),
  C.$(t.g).innerHTML+=`<div id="${t.n}"class="group ${t.css}"style="position:absolute;width:${t.w}${C.unit};height:${t.d}${C.unit};transform:${C.tr(t)}">`
},*/

// Plane
plane: t => {
  t.n||(t.n=`plane${C.plane_count++}`),
  C.init(t),
  C.$(t.g).innerHTML+=`<div id="${t.n}"class="plane ${t.css}"style="position:absolute;width:${t.w}${C.unit};height:${t.h}${C.unit};background:${t.b};transform-origin:${t.o};transform:${C.tr(t)}">${t.html}`,
  C.camera()
},

// Move the camera
camera: t => {
  t&&(t.x||0===t.x)&&(C.camX=t.x),
  t&&(t.y||0===t.y)&&(C.camY=t.y),
  t&&(t.z||0===t.z)&&(C.camZ=t.z),
  t&&(t.rx||0===t.rx)&&(C.camRX=t.rx),
  t&&(t.ry||0===t.ry)&&(C.camRY=t.ry),
  t&&(t.rz||0===t.rz)&&(C.camRZ=t.rz),
  C.camX+=(Math.random()-.5)/1e3,
  scene.style.transform=`translateX(${-C.camX}${C.unit})translateY(${-C.camY}${C.unit})translateZ(${-C.camZ}${C.unit})rotateX(${C.camRX}deg)rotateY(${C.camRY}deg)rotateZ(${C.camRZ}deg)`;
  for(var r in C.sprites){
    var n=C.$(C.sprites[r]),
    o=n.style.transform.replace(/ *rotate.*\(.*?deg\)/g,"");
    n.style.transform=o+`rotateZ(${-C.camRZ}deg)rotateX(${-C.camRX}deg)`
  }
},

// Move an object
move: t => {
  if(t.n){
   var r=C.$(t.n),
   n=C.options[t.n];
   (t.x||0===t.x)&&(n.x=t.x),
   (t.y||0===t.y)&&(n.y=t.y),
   (t.z||0===t.z)&&(n.z=t.z),
   (t.rx||0===t.rx)&&(n.rx=t.rx),
   (t.ry||0===t.ry)&&(n.ry=t.ry),
   (t.rz||0===t.rz)&&(n.rz=t.rz),
   C.options[t.n]=n,
   r.style.transform=C.tr(n)
 }
},

// CSS3D transform string
tr: t => `translateX(-50%)translateY(-50%)translateX(${t.x}${C.unit})translateY(${t.y}${C.unit})translateZ(${t.z}${C.unit})rotateX(${t.rx}deg)rotateY(${t.ry}deg)rotateZ(${t.rz}deg)scaleX(${t.sx})scaleY(${t.sy})scaleZ(${t.sz})`

}


for(i = 0; i < 8; i++){
  for(j = 12; j--;){
    if(j==0 && i % 2) continue;
    if(!(j % 2) && i == 7) continue;
    dx = 0;
    w = 102;
    if(j % 2) dx = 47;
    if(dx == 47 && (i == 0)) { w = 50; dx = 22 }
    if(dx == 47 && (i == 7)) { w = 50; dx = 75 }
    x = i*98 - 300 - dx + Math.random();
    ry = -(x+10)/22;
    z = -(Math.cos(x/300) * 90);
    C.plane({x,y:j*48-200 + Math.random(),w,h:50,b:`hsl(50 0% ${35-z/4}%)`,ry,z,css:"brick"});
  }
}

for(i = 0; i < 8; i++){
  for(j = 2; j < 9; j++){
    if(i>0) continue;
    w = 30 + ((j%2) ? 10 : 0);
    x = i*98 - 300 - 36 + Math.random()*4+ ((j%2) ? 5 : 0);
    ry = (x+10)/22;
    z = (Math.cos(x/300) * 90)-50;
    C.plane({x,y:j*52-200 + Math.random()-8,w,h:55,b:`hsl(50 0% 70%)`,ry,z,css:"brick"});
  }
}

for(i = 0; i < 8; i++){
  for(j = 2; j < 9; j++){
    if(i < 7) continue;
    w = 30 + ((j%2) ? 10 : 0);
    x = i*98 - 300 - 63 + Math.random()*4 - ((j%2) ? 5 : 0);
    ry = (x+10)/22;
    z = (Math.cos(x/300) * 90)-50;
    C.plane({x,y:j*52-200 + Math.random()-8,w,h:55,b:`hsl(50 0% 70%)`,ry,z,css:"brick"});
  }
}

for(i = 0; i < 8; i++){
  for(j = 12; j--;){
    if(j==0 && i % 2) continue;
    if(!(j % 2) && i == 7) continue;
    dx = 0;
    w = 102;
    if(j % 2) dx = 47;
    if(dx == 47 && (i == 0)) { w = 50; dx = 22 }
    if(dx == 47 && (i == 7)) { w = 50; dx = 75 }
    x = i*98 - 300 - dx + Math.random();
    ry = (x+10)/22;
    z = (Math.cos(x/300) * 90)-45;
    C.plane({x,y:j*50-200 + Math.random()-5,w,h:52,b:`hsl(50 0% ${70+z/4}%)`,ry,z,css:(j>8 || j < 2)?"brick":"brick fade"});
  }
}

C.plane({x:-5,y:-130,z:-20,w:690,h:70,b:"linear-gradient(#333,#555)",rx:105,css:"c"});
C.plane({x:-5,y:225,z:-20,w:690,h:70,b:"linear-gradient(#333,#555)",rx:70,css:"c"});
C.plane({x:-130,y:35,w:30,h:30,html:"🚪",css:"door",ry:5});
C.plane({x:-100,y:100,w:30,h:30,html:"🔒",css:"lock",rz:-2});
C.plane({x:120,y:-10,w:30,h:30,html:"🖼️",css:"frame",rz:2});
C.plane({x:165,y:32,w:30,h:30,html:"️🧔🏻‍♂️",css:"head",rz:2});
C.plane({x:165,y:14,w:30,h:30,html:"👑️",css:"crown",rz:2,sy:.5});
C.plane({x:260,y:50,w:30,h:30,html:"🛏️",css:"bed", sx:-1});
C.plane({x:-230,y:205,z:-40,w:30,h:30,html:"🕳️",css:"hole",rz:90,sy:2});
C.plane({x:-300,y:-35,z:-40,w:30,h:30,html:"<svg width=99 height=99 xmlns='http://www.w3.org/2000/svg'><path d='M5 95A35 75 0 0 1 75 95Z' fill='#def' stroke='#555' stroke-width='4'/><path d='M75 95A35 77 0 0 0 33 21A40 89 0 0 1 65 94Z' fill='#777' stroke='#555' stroke-width='4'/></svg>️",css:"window"});
C.plane({x:-300,y:-35,z:-40,w:30,h:30,html:"<svg width=99 height=99 xmlns='http://www.w3.org/2000/svg'><path d='M25 30L24 95M44 28L45 95' fill='#fff' stroke='#111' stroke-width='8'/></svg>",css:"bars"});
C.plane({x:-555,y:-222,z:-100,w:400,h:400,b:"radial-gradient(#ffb 5%,#fff0 50%)",css:"sun"});
C.plane({x:0,y:0,z:0,w:700,h:500,b:"#f000",html:"<canvas id=sun width=700 height=500>"});
ctx=sun.getContext("2d");
ctx.fillStyle = "#ffb3";
ctx.beginPath();
ctx.moveTo(65,295);
ctx.lineTo(155,455);
ctx.lineTo(275,455);
ctx.lineTo(85,220);
ctx.closePath();
ctx.fill();
</script>

<style>
#scene div { font-size: 170px; font-family: e; }
#viewport { background: linear-gradient(#bcf,#def) }
#scene .c { border-radius: 50%; border-width:8px; }
#scene .brick { border: 4px solid #555; pointer-events: none;}
#scene .door { filter: sepia(.5) drop-shadow(0 0 4px #000) }
#scene .lock { font-size: 40px; filter: sepia(.5) saturate(.5) drop-shadow(0 0 2px #000) }
#scene .bed { filter: sepia(.8) drop-shadow(0 0 4px #000)}
#scene .hole { font-size: 40px; }
#scene .frame { font-size: 90px; filter: sepia(.9) drop-shadow(0 0 4px #000) }
#scene .head { font-size: 30px; filter: sepia(.5) }
#scene .crown { font-size: 30px; filter: sepia(.5) drop-shadow(0 0 4px #000) }
.fade { transition: opacity .5s; transition-delay: .5s; opacity: 0 }
</style>